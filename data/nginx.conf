# We've moved the nginx configuration file to our new configuration generator tool. It now is easier to generate a configuraiton file for your web server:
#
# https://config.fossbilling.org/
 server {
     listen 80;

     set $root_path '/var/www/fossbilling/src';
     server_name fossbilling.vm www.fossbilling.vm;

     index index.html index.htm index.php;
     root $root_path;
     try_files $uri $uri/ @rewrite;
     sendfile off;
     
     include /etc/nginx/mime.types;


     location @rewrite {
         rewrite ^/page/(.*)$ /index.php?_url=/custompages/$1;
         rewrite ^/(.*)$ /index.php?_url=/$1;
     }

     location ~ \.php {
         fastcgi_split_path_info ^(.+\.php)(/.+)$;

         # fastcgi_pass need to be changed according your server setup:
         # phpx.x is your server setup
         # examples: /var/run/phpx.x-fpm.sock, /var/run/php/phpx.x-fpm.sock or /run/php/phpx.x-fpm.sock are all valid options 
         # Or even localhost:port (Default 9000 will work fine) 
         # Please check your server setup

        fastcgi_pass unix:/run/php/phpx.x-fpm.sock

         fastcgi_param PATH_INFO       $fastcgi_path_info;
         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
         fastcgi_intercept_errors on;

         include fastcgi_params;
     }

     # Disable PHP execution in bb-uploads and bb-data
     location ^~ /bb-uploads/ { }
     location ^~ /bb-data/ {
       deny all;
     }

     location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
         root $root_path;
         expires off;
     }

     location ~ /\.ht {
         deny all;
     }
 }
